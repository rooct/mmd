import{s as W,b as G,e as v,h as Q,c as S,d as Z,g as c,p as b,q as k,j as d,k as O,n as C,m as V,o as X,u as Y,v as q,t as g,f as y,w as B,x,l as $}from"./scheduler.onfvv5bY.js";import{e as L,p as ee}from"./svg-pan-zoom.SIENSGK2.js";import{S as oe,i as te}from"./index.UU9Z4W6E.js";import{a6 as T,a7 as j,a8 as re,a9 as F,aa as ne,a as le}from"./state.Ogi6eOw3.js";function J(i,l,t){const n=i.slice();return n[18]=l[t],n}function K(i){let l,t;function n(r,a){return r[2]?ie:se}let e=n(i),o=e(i);return{c(){l=v("div"),o.c(),this.h()},l(r){l=S(r,"DIV",{class:!0,id:!0});var a=Z(l);o.l(a),a.forEach(c),this.h()},h(){b(l,"class",t="absolute z-10 w-full p-2 font-mono "+(i[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left"),b(l,"id","errorContainer")},m(r,a){d(r,l,a),o.m(l,null)},p(r,a){e===(e=n(r))&&o?o.p(r,a):(o.d(1),o=e(r),o&&(o.c(),o.m(l,null))),a&4&&t!==(t="absolute z-10 w-full p-2 font-mono "+(r[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left")&&b(l,"class",t)},d(r){r&&c(l),o.d()}}}function se(i){let l,t,n,e,o,r,a,m,p;return{c(){l=g("Diagram out of sync. "),t=v("br"),n=g(`
      Press `),e=v("i"),o=g(" (Sync button) or "),r=v("kbd"),a=g(F),m=g(" + Enter"),p=g(" to sync."),this.h()},l(f){l=y(f,"Diagram out of sync. "),t=S(f,"BR",{}),n=y(f,`
      Press `),e=S(f,"I",{class:!0}),Z(e).forEach(c),o=y(f," (Sync button) or "),r=S(f,"KBD",{});var u=Z(r);a=y(u,F),m=y(u," + Enter"),u.forEach(c),p=y(f," to sync."),this.h()},h(){b(e,"class","fas fa-sync")},m(f,u){d(f,l,u),d(f,t,u),d(f,n,u),d(f,e,u),d(f,o,u),d(f,r,u),O(r,a),O(r,m),d(f,p,u)},p:C,d(f){f&&(c(l),c(t),c(n),c(e),c(o),c(r),c(p))}}}function ie(i){let l,t=L(i[3]),n=[];for(let e=0;e<t.length;e+=1)n[e]=M(J(i,t,e));return{c(){for(let e=0;e<n.length;e+=1)n[e].c();l=B()},l(e){for(let o=0;o<n.length;o+=1)n[o].l(e);l=B()},m(e,o){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,o);d(e,l,o)},p(e,o){if(o&8){t=L(e[3]);let r;for(r=0;r<t.length;r+=1){const a=J(e,t,r);n[r]?n[r].p(a,o):(n[r]=M(a),n[r].c(),n[r].m(l.parentNode,l))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(e){e&&c(l),x(n,e)}}}function M(i){let l=i[18]+"",t,n;return{c(){t=g(l),n=v("br")},l(e){t=y(e,l),n=S(e,"BR",{})},m(e,o){d(e,t,o),d(e,n,o)},p(e,o){o&8&&l!==(l=e[18]+"")&&$(t,l)},d(e){e&&(c(t),c(n))}}}function ae(i){let l,t,n,e=(i[2]&&i[6].error instanceof Error||i[4])&&K(i);return{c(){e&&e.c(),l=G(),t=v("div"),n=v("div"),this.h()},l(o){e&&e.l(o),l=Q(o),t=S(o,"DIV",{id:!0,class:!0});var r=Z(t);n=S(r,"DIV",{id:!0,class:!0}),Z(n).forEach(c),r.forEach(c),this.h()},h(){b(n,"id","container"),b(n,"class","h-full overflow-auto svelte-1ewr4tw"),k(n,"hide",i[5]),b(t,"id","view"),b(t,"class","h-full p-2 svelte-1ewr4tw"),k(t,"error",i[2]),k(t,"outOfSync",i[4])},m(o,r){e&&e.m(o,r),d(o,l,r),d(o,t,r),O(t,n),i[7](n),i[8](t)},p(o,[r]){o[2]&&o[6].error instanceof Error||o[4]?e?e.p(o,r):(e=K(o),e.c(),e.m(l.parentNode,l)):e&&(e.d(1),e=null),r&32&&k(n,"hide",o[5]),r&4&&k(t,"error",o[2]),r&16&&k(t,"outOfSync",o[4])},i:C,o:C,d(o){o&&(c(l),c(t)),e&&e.d(o),i[7](null),i[8](null)}}}function fe(i,l,t){let n,e;V(i,T,s=>t(6,n=s)),V(i,j,s=>t(14,e=s));let o="",r="",a,m,p=!1,f=[],u=!1,z=!1,P=!0,I=n.panZoom,h;const N=()=>{if(!h)return;const s=h.getPan(),_=h.getZoom();ne({pan:s,zoom:_}),le("panZoom")},R=s=>{console.log("state--",JSON.stringify(s)),s.panZoom&&(t(5,z=!0),h?.destroy(),h=void 0,Promise.resolve().then(()=>{const _=document.querySelector("#graph-div");if(!_)return;h=ee(_,{onPan:N,onZoom:N,controlIconsEnabled:!0,fit:!0,center:!0});const{pan:w,zoom:E}=s;w!==void 0&&E!==void 0&&Number.isFinite(E)&&(h.zoom(E),h.pan(w)),t(5,z=!1)}))},A=async s=>{if(s.error!==void 0){t(2,p=!0),t(3,f=s.error.toString().split(`
`));return}t(2,p=!1);try{if(a&&s&&(s.updateDiagram||s.autoSync)){if(s.autoSync||Y(j,e.updateDiagram=!1,e),t(4,u=!1),P=!0,o===s.code&&r===s.mermaid&&I===s.panZoom)return;o=s.code,r=s.mermaid,I=s.panZoom;const _=m.parentElement?.scrollTop;delete a.dataset.processed;const{svg:w,bindFunctions:E}=await re(Object.assign({},JSON.parse(s.mermaid)),o,"graph-div");if(w.length>0){R(s),t(0,a.innerHTML=w,a),console.log({svg:w});const D=document.querySelector("#graph-div");if(!D)throw new Error("graph-div not found");D.setAttribute("height","100%"),D.style.maxWidth="100%",E&&E(D)}m.parentElement&&_&&t(1,m.parentElement.scrollTop=_,m),t(2,p=!1)}else P?P=!1:(o!==s.code||r!==s.mermaid)&&t(4,u=!0)}catch(_){console.error("view fail",_),t(2,p=!0)}};X(()=>{T.subscribe(s=>{A(s)}),window.addEventListener("resize",()=>{n.panZoom&&h&&h.resize()})});function H(s){q[s?"unshift":"push"](()=>{a=s,t(0,a)})}function U(s){q[s?"unshift":"push"](()=>{m=s,t(1,m)})}return[a,m,p,f,u,z,n,H,U]}class pe extends oe{constructor(l){super(),te(this,l,fe,ae,W,{})}}export{pe as V};
