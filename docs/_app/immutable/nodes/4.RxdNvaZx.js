import{s as R,b as Q,e as S,h as X,c as y,d as E,g as f,p as h,q as w,j as m,k as Z,n as D,m as J,o as Y,u as x,v as V,t as g,f as b,w as q,x as $,l as ee}from"../chunks/scheduler.onfvv5bY.js";import{S as A,i as F,c as te,a as re,m as oe,t as ne,b as le,d as se}from"../chunks/index.UU9Z4W6E.js";import{e as B,p as ae}from"../chunks/svg-pan-zoom.SIENSGK2.js";import{a7 as L,a6 as ie,a8 as ce,a9 as T,aa as fe,a as ue}from"../chunks/state.Ogi6eOw3.js";function j(s,l,t){const o=s.slice();return o[18]=l[t],o}function K(s){let l,t;function o(r,i){return r[2]?pe:me}let e=o(s),n=e(s);return{c(){l=S("div"),n.c(),this.h()},l(r){l=y(r,"DIV",{class:!0,id:!0});var i=E(l);n.l(i),i.forEach(f),this.h()},h(){h(l,"class",t="absolute z-10 w-full p-2 font-mono "+(s[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left"),h(l,"id","errorContainer")},m(r,i){m(r,l,i),n.m(l,null)},p(r,i){e===(e=o(r))&&n?n.p(r,i):(n.d(1),n=e(r),n&&(n.c(),n.m(l,null))),i&4&&t!==(t="absolute z-10 w-full p-2 font-mono "+(r[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left")&&h(l,"class",t)},d(r){r&&f(l),n.d()}}}function me(s){let l,t,o,e,n,r,i,p,_;return{c(){l=g("Diagram out of sync. "),t=S("br"),o=g(`
      Press `),e=S("i"),n=g(" (Sync button) or "),r=S("kbd"),i=g(T),p=g(" + Enter"),_=g(" to sync."),this.h()},l(c){l=b(c,"Diagram out of sync. "),t=y(c,"BR",{}),o=b(c,`
      Press `),e=y(c,"I",{class:!0}),E(e).forEach(f),n=b(c," (Sync button) or "),r=y(c,"KBD",{});var u=E(r);i=b(u,T),p=b(u," + Enter"),u.forEach(f),_=b(c," to sync."),this.h()},h(){h(e,"class","fas fa-sync")},m(c,u){m(c,l,u),m(c,t,u),m(c,o,u),m(c,e,u),m(c,n,u),m(c,r,u),Z(r,i),Z(r,p),m(c,_,u)},p:D,d(c){c&&(f(l),f(t),f(o),f(e),f(n),f(r),f(_))}}}function pe(s){let l,t=B(s[3]),o=[];for(let e=0;e<t.length;e+=1)o[e]=M(j(s,t,e));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();l=q()},l(e){for(let n=0;n<o.length;n+=1)o[n].l(e);l=q()},m(e,n){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,n);m(e,l,n)},p(e,n){if(n&8){t=B(e[3]);let r;for(r=0;r<t.length;r+=1){const i=j(e,t,r);o[r]?o[r].p(i,n):(o[r]=M(i),o[r].c(),o[r].m(l.parentNode,l))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(e){e&&f(l),$(o,e)}}}function M(s){let l=s[18]+"",t,o;return{c(){t=g(l),o=S("br")},l(e){t=b(e,l),o=y(e,"BR",{})},m(e,n){m(e,t,n),m(e,o,n)},p(e,n){n&8&&l!==(l=e[18]+"")&&ee(t,l)},d(e){e&&(f(t),f(o))}}}function de(s){let l,t,o,e=(s[2]&&s[6].error instanceof Error||s[4])&&K(s);return{c(){e&&e.c(),l=Q(),t=S("div"),o=S("div"),this.h()},l(n){e&&e.l(n),l=X(n),t=y(n,"DIV",{id:!0,class:!0});var r=E(t);o=y(r,"DIV",{id:!0,class:!0}),E(o).forEach(f),r.forEach(f),this.h()},h(){h(o,"id","container"),h(o,"class","h-full overflow-auto svelte-1ewr4tw"),w(o,"hide",s[5]),h(t,"id","view"),h(t,"class","h-full p-2 svelte-1ewr4tw"),w(t,"error",s[2]),w(t,"outOfSync",s[4])},m(n,r){e&&e.m(n,r),m(n,l,r),m(n,t,r),Z(t,o),s[7](o),s[8](t)},p(n,[r]){n[2]&&n[6].error instanceof Error||n[4]?e?e.p(n,r):(e=K(n),e.c(),e.m(l.parentNode,l)):e&&(e.d(1),e=null),r&32&&w(o,"hide",n[5]),r&4&&w(t,"error",n[2]),r&16&&w(t,"outOfSync",n[4])},i:D,o:D,d(n){n&&(f(l),f(t)),e&&e.d(n),s[7](null),s[8](null)}}}let he=!0;function _e(s,l,t){let o,e;J(s,L,a=>t(13,o=a)),J(s,ie,a=>t(6,e=a));let n="",r,i,p=!1,_=[],c=!1,u=!1,O=!0,v;const I=()=>{if(!v)return;const a=v.getPan(),d=v.getZoom();fe({pan:a,zoom:d}),ue("panZoom")};let P=localStorage.getItem("codeStore")||"";const H=()=>{P=localStorage.getItem("codeStore")||"",N(JSON.parse(P))},U=a=>{a.panZoom&&(t(5,u=!0),v?.destroy(),v=void 0,Promise.resolve().then(()=>{const d=document.querySelector("#graph-div");d&&(v=ae(d,{onPan:I,onZoom:I,controlIconsEnabled:!0,fit:!0,center:!0}),t(5,u=!1))}))},N=async a=>{if(a.error!==void 0){t(2,p=!0),t(3,_=a.error.toString().split(`
`));return}t(2,p=!1);try{if(r&&a&&(a.updateDiagram||a.autoSync)){if(a.autoSync||x(L,o.updateDiagram=!1,o),t(4,c=!1),O=!0,n===JSON.parse(a.mermaid)&&he===a.panZoom)return;n=JSON.parse(a.mermaid);const d=i.parentElement?.scrollTop;delete r.dataset.processed;const{svg:C,bindFunctions:z}=await ce(Object.assign({},JSON.parse(a.mermaid)),a.code,"graph-div");if(C.length>0){U(a),t(0,r.innerHTML=C,r);const k=document.querySelector("#graph-div");if(!k)throw new Error("graph-div not found");k.setAttribute("height","100%"),k.style.maxWidth="100%",z&&z(k)}i.parentElement&&d&&t(1,i.parentElement.scrollTop=d,i),t(2,p=!1)}else O?O=!1:n!==a.mermaid&&t(4,c=!0)}catch(d){console.error("view fail",d),t(2,p=!0)}};Y(()=>{N(JSON.parse(P)),window.addEventListener("storage",H)});function W(a){V[a?"unshift":"push"](()=>{r=a,t(0,r)})}function G(a){V[a?"unshift":"push"](()=>{i=a,t(1,i)})}return[r,i,p,_,c,u,e,W,G]}class ge extends A{constructor(l){super(),F(this,l,_e,de,R,{})}}function be(s){let l,t;return l=new ge({}),{c(){te(l.$$.fragment)},l(o){re(l.$$.fragment,o)},m(o,e){oe(l,o,e),t=!0},p:D,i(o){t||(ne(l.$$.fragment,o),t=!0)},o(o){le(l.$$.fragment,o),t=!1},d(o){se(l,o)}}}class Ee extends A{constructor(l){super(),F(this,l,null,be,R,{})}}export{Ee as component};
