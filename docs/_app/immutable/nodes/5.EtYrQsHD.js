import{s as M,b as Y,e as v,h as x,c as S,d as Z,g as f,p as b,q as k,j as m,k as C,n as z,m as q,o as R,u as $,v as V,t as g,f as y,w as B,x as ee,l as te}from"../chunks/scheduler.Hc0zsjGk.js";import{S as A,i as U,c as oe,a as ne,m as re,t as le,b as se,d as ie}from"../chunks/index.8NpVrFgD.js";import{e as L,p as ae}from"../chunks/svg-pan-zoom.M2gKyen7.js";import{a5 as T,a6 as j,a7 as ce,a8 as F,a9 as fe,a as ue,aa as me}from"../chunks/state.lg6kGnO8.js";/* empty css                                                   */function H(i,l,t){const o=i.slice();return o[18]=l[t],o}function J(i){let l,t;function o(r,a){return r[2]?de:pe}let e=o(i),n=e(i);return{c(){l=v("div"),n.c(),this.h()},l(r){l=S(r,"DIV",{class:!0,id:!0});var a=Z(l);n.l(a),a.forEach(f),this.h()},h(){b(l,"class",t="absolute z-10 w-full p-2 font-mono "+(i[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left"),b(l,"id","errorContainer")},m(r,a){m(r,l,a),n.m(l,null)},p(r,a){e===(e=o(r))&&n?n.p(r,a):(n.d(1),n=e(r),n&&(n.c(),n.m(l,null))),a&4&&t!==(t="absolute z-10 w-full p-2 font-mono "+(r[2]?"text-red-600":"text-yellow-600")+" bg-base-100 bg-opacity-80 text-left")&&b(l,"class",t)},d(r){r&&f(l),n.d()}}}function pe(i){let l,t,o,e,n,r,a,p,d;return{c(){l=g("Diagram out of sync. "),t=v("br"),o=g(`
      Press `),e=v("i"),n=g(" (Sync button) or "),r=v("kbd"),a=g(F),p=g(" + Enter"),d=g(" to sync."),this.h()},l(c){l=y(c,"Diagram out of sync. "),t=S(c,"BR",{}),o=y(c,`
      Press `),e=S(c,"I",{class:!0}),Z(e).forEach(f),n=y(c," (Sync button) or "),r=S(c,"KBD",{});var u=Z(r);a=y(u,F),p=y(u," + Enter"),u.forEach(f),d=y(c," to sync."),this.h()},h(){b(e,"class","fas fa-sync")},m(c,u){m(c,l,u),m(c,t,u),m(c,o,u),m(c,e,u),m(c,n,u),m(c,r,u),C(r,a),C(r,p),m(c,d,u)},p:z,d(c){c&&(f(l),f(t),f(o),f(e),f(n),f(r),f(d))}}}function de(i){let l,t=L(i[3]),o=[];for(let e=0;e<t.length;e+=1)o[e]=K(H(i,t,e));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();l=B()},l(e){for(let n=0;n<o.length;n+=1)o[n].l(e);l=B()},m(e,n){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,n);m(e,l,n)},p(e,n){if(n&8){t=L(e[3]);let r;for(r=0;r<t.length;r+=1){const a=H(e,t,r);o[r]?o[r].p(a,n):(o[r]=K(a),o[r].c(),o[r].m(l.parentNode,l))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(e){e&&f(l),ee(o,e)}}}function K(i){let l=i[18]+"",t,o;return{c(){t=g(l),o=v("br")},l(e){t=y(e,l),o=S(e,"BR",{})},m(e,n){m(e,t,n),m(e,o,n)},p(e,n){n&8&&l!==(l=e[18]+"")&&te(t,l)},d(e){e&&(f(t),f(o))}}}function he(i){let l,t,o,e=(i[2]&&i[6].error instanceof Error||i[4])&&J(i);return{c(){e&&e.c(),l=Y(),t=v("div"),o=v("div"),this.h()},l(n){e&&e.l(n),l=x(n),t=S(n,"DIV",{id:!0,class:!0});var r=Z(t);o=S(r,"DIV",{id:!0,class:!0}),Z(o).forEach(f),r.forEach(f),this.h()},h(){b(o,"id","container"),b(o,"class","h-full overflow-auto svelte-1ewr4tw"),k(o,"hide",i[5]),b(t,"id","view"),b(t,"class","h-full p-2 svelte-1ewr4tw"),k(t,"error",i[2]),k(t,"outOfSync",i[4])},m(n,r){e&&e.m(n,r),m(n,l,r),m(n,t,r),C(t,o),i[7](o),i[8](t)},p(n,[r]){n[2]&&n[6].error instanceof Error||n[4]?e?e.p(n,r):(e=J(n),e.c(),e.m(l.parentNode,l)):e&&(e.d(1),e=null),r&32&&k(o,"hide",n[5]),r&4&&k(t,"error",n[2]),r&16&&k(t,"outOfSync",n[4])},i:z,o:z,d(n){n&&(f(l),f(t)),e&&e.d(n),i[7](null),i[8](null)}}}function _e(i,l,t){let o,e;q(i,T,s=>t(6,o=s)),q(i,j,s=>t(14,e=s));let n="",r="",a,p,d=!1,c=[],u=!1,P=!1,O=!0,I=o.panZoom,h;const N=()=>{if(!h)return;const s=h.getPan(),_=h.getZoom();fe({pan:s,zoom:_}),ue("panZoom")},W=s=>{console.log("state--",JSON.stringify(s)),s.panZoom&&(t(5,P=!0),h?.destroy(),h=void 0,Promise.resolve().then(()=>{const _=document.querySelector("#graph-div");if(!_)return;h=ae(_,{onPan:N,onZoom:N,controlIconsEnabled:!0,fit:!0,center:!0});const{pan:w,zoom:E}=s;w!==void 0&&E!==void 0&&Number.isFinite(E)&&(h.zoom(E),h.pan(w)),t(5,P=!1)}))},G=async s=>{if(s.error!==void 0){t(2,d=!0),t(3,c=s.error.toString().split(`
`));return}t(2,d=!1);try{if(a&&s&&(s.updateDiagram||s.autoSync)){if(s.autoSync||$(j,e.updateDiagram=!1,e),t(4,u=!1),O=!0,n===s.code&&r===s.mermaid&&I===s.panZoom)return;n=s.code,r=s.mermaid,I=s.panZoom;const _=p.parentElement?.scrollTop;delete a.dataset.processed;const{svg:w,bindFunctions:E}=await ce(Object.assign({},JSON.parse(s.mermaid)),n,"graph-div");if(w.length>0){W(s),t(0,a.innerHTML=w,a),console.log({svg:w});const D=document.querySelector("#graph-div");if(!D)throw new Error("graph-div not found");D.setAttribute("height","100%"),D.style.maxWidth="100%",E&&E(D)}p.parentElement&&_&&t(1,p.parentElement.scrollTop=_,p),t(2,d=!1)}else O?O=!1:(n!==s.code||r!==s.mermaid)&&t(4,u=!0)}catch(_){console.error("view fail",_),t(2,d=!0)}};R(()=>{T.subscribe(s=>{G(s)}),window.addEventListener("resize",()=>{o.panZoom&&h&&h.resize()})});function Q(s){V[s?"unshift":"push"](()=>{a=s,t(0,a)})}function X(s){V[s?"unshift":"push"](()=>{p=s,t(1,p)})}return[a,p,d,c,u,P,o,Q,X]}class be extends A{constructor(l){super(),U(this,l,_e,he,M,{})}}function ge(i){let l,t;return l=new be({}),{c(){oe(l.$$.fragment)},l(o){ne(l.$$.fragment,o)},m(o,e){re(l,o,e),t=!0},p:z,i(o){t||(le(l.$$.fragment,o),t=!0)},o(o){se(l.$$.fragment,o),t=!1},d(o){ie(l,o)}}}function ye(i){return R(me),[]}class Ze extends A{constructor(l){super(),U(this,l,ye,ge,M,{})}}export{Ze as component};
